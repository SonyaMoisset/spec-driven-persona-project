# Threat Model: User Registration Service

This document outlines the threat model for the user registration service using the STRIDE framework.

| Threat Category | Threat | Mitigation |
| :--- | :--- | :--- |
| **S**poofing | **Attacker registers with an email they don't own.** | **Email Verification:** Accounts are created in a `pending` state and are not usable until the user proves ownership of the email address by clicking a unique link sent to it. |
| | **Attacker attempts to impersonate another user by guessing their password.** | **Secure Authentication:** While not part of registration, the future login endpoint will use strong password hashing (bcrypt) and implement account lockout policies after multiple failed attempts. |
| **T**ampering | **An attacker modifies the registration request in transit (e.g., changing the email).** | **HTTPS/TLS:** All communication between the client and the API is encrypted, preventing man-in-the-middle attacks. |
| | **An attacker modifies the verification link/token to try and verify a different account.** | **Secure, Hashed Tokens:** The verification token is a high-entropy, random string. It is hashed before being stored in the database. The link between the token and the user is maintained internally, so the token cannot be used for another user. |
| | **An attacker modifies data directly in the database.** | **Principle of Least Privilege:** The API connects to the database with a user that has limited permissions (only to its required tables). Database access from the outside world is blocked at the network level. |
| **R**epudiation | **A user denies having created an account.** | **Audit Logging:** Log all registration attempts (successful and failed) with the source IP address and timestamp. Log the verification event, also with IP and timestamp. This provides a clear audit trail. |
| **I**nformation Disclosure | **An attacker uses the registration endpoint to discover if an email address is already registered (user enumeration).** | **Vague Error Messages:** On registration attempts for an existing email, return a generic message like "If an account with this email exists, a password reset link has been sent" (for password reset) or a generic success message for registration to avoid confirming/denying the existence of an email. *Decision: For registration, we will return a `409 Conflict` error as per the API spec for clarity to the frontend, accepting the trade-off of potential enumeration. This can be revisited if it becomes a problem.* |
| | **Error messages leak sensitive information (e.g., stack traces, database errors).** | **Generic Error Handling:** A global error handler in the API will catch all exceptions and return a standardized, generic error message to the client without exposing internal details. |
| | **An attacker gains access to the database backup and reads user passwords.** | **Password Hashing:** Passwords are not stored in plaintext. They are hashed with bcrypt, making it computationally expensive to reverse them even if the database is compromised. |
| **D**enial of Service | **An attacker floods the registration endpoint with requests to overwhelm the service or send spam emails.** | **Rate Limiting:** Implement strict rate limiting on the registration and verification endpoints based on IP address to limit the number of requests a single entity can make in a given time period. |
| | **An attacker registers with a large number of fake accounts, filling up the database.** | **Email Verification & CAPTCHA:** Email verification ensures that an attacker needs a valid, accessible email for each account, which raises the cost of the attack. A CAPTCHA challenge could be added as a further mitigation if bot registrations become a significant problem. |
| **E**levation of Privilege | **A user manages to verify their account without the correct token.** | **Secure Token Validation:** The verification process must be atomic and securely validate that the provided token is valid, not expired, and belongs to the user being verified before changing the account status to `active`. |
| | **A compromised user account with `pending` status is used to access the application.** | **Strict Authorization Checks:** Application logic must enforce that only users with an `active` status can access protected resources or perform privileged actions. |
